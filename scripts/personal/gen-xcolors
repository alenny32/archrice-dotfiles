#!/bin/sh

# Script to generate color variables based on xresources.

SCRIPT_NAME="$(basename "$0")"

file_name="xcolors"
save_path="${XDG_DATA_HOME:-$HOME/.local/share}"
full_path="$save_path/$file_name"

# xresources_path="$HOME/.Xresources"
xresources_path="${XDG_CONFIG_HOME:-$HOME/.config}/x11/xresources"

# # Get xresources colors
# get_color() {
#     sed -n '/^!!.*:$/I, /!!/p' "$xresources_path" |
#         sed -n '/color0/, /color15/p' |
#         grep "$1:" |
#         awk '{print $2}'
# }

# Get colorscheme name and the colors
colorscheme="$(grep -PB1 "^\*\.(foreground|color0):\s*\#\w{6}$" "$xresources_path" |
    head -1 |
    cut -d ' ' -f 2- |
    tr -d ':')"
colors="$(grep -P "^\*\.color\d{1,2}:\s*\#\w{6}$" "$xresources_path" |
    tr -d '*.' |
    tr ':' '=' |
    tr -d ' ')"

{
    # Boilerplate
    printf "#\n"
    printf "# Xresources colors generated by %s.\n" "$SCRIPT_NAME"
    printf "# Generated at %s.\n#\n" "$(date)"
    printf "# Using the %s colorscheme:\n#\n\n" "$colorscheme"

    # Print the colors
    printf "%s\n" "$colors"

    # # Generate colors
    # i=0
    # for color in ${colors}; do
    #     # printf "color%s=%s\n" "${i}" "${color}"
    #     i="$((i+1))"
    # done

    # Vim syntax highlighting (python or dosini will work)
    printf "\n# vim: filetype=dosini"
} > "$full_path"
